---
const RAW_BASE = import.meta.env.BASE_URL;

function withBase(path: string = ""): string {
  const b = RAW_BASE.endsWith("/") ? RAW_BASE.slice(0, -1) : RAW_BASE; // "/personalsite"
  const p = path ? (path.startsWith("/") ? path : `/${path}`) : "/";    // "/projects" or "/"
  return `${b}${p}`;                                                    // "/personalsite/projects" or "/personalsite/"
}

const links: { href: string; label: string }[] = [
  { href: withBase(""),         label: "home" },
  { href: withBase("projects"), label: "my projects" },
  { href: withBase("logbook"),  label: "logbook" },
  { href: withBase("blog"),     label: "blog" },
];
---

<header class="topbar">
  <nav class="tabs">
    {links.map((l) => (
      <a href={l.href} class="tab">{l.label}</a>
    ))}
  </nav>
  <button id="toggleTheme" class="invert-btn" aria-pressed="false" aria-label="Invert site">invert</button>
</header>

<script is:inline>
(function () {
  var btn  = document.getElementById('toggleTheme');
  if (!btn) return;

  var root = document.documentElement;         
  var KEY  = 'theme';
  var PREV = 'prev-theme';

  var saved = localStorage.getItem(KEY);
  if (saved === 'light' || saved === 'dark' || saved === 'spooky') {
    root.setAttribute('data-theme', saved);
  }
  
  btn.setAttribute('aria-pressed', String(root.getAttribute('data-theme') === 'spooky'));

  btn.addEventListener('click', function(){
    var cur = root.getAttribute('data-theme') || 'dark';
    if (cur === 'spooky') {
      var prev = localStorage.getItem(PREV) || 'dark';
      root.setAttribute('data-theme', prev);
      localStorage.setItem(KEY, prev);
      btn.setAttribute('aria-pressed', 'false');
    } else {
      localStorage.setItem(PREV, cur);
      root.setAttribute('data-theme', 'spooky');
      localStorage.setItem(KEY, 'spooky');
      btn.setAttribute('aria-pressed', 'true');
    }
  });
})();
</script>
